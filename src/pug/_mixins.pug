-
  const Path = require('path')
  const FS = require('fs')
  const YAML = require('yaml')

  const SECTION = PATH.split('/')[1]
  const SECTION_2 = PATH.split('/')[2]
  const SECTION_3 = PATH.split('/')[3]
  const PAGE = Path.basename(PATH)

  const db = YAML.parse(FS.readFileSync('src/pug/db/_data.yaml', 'utf8'))

  const org = {
    repos: 'https://github.com/orgs/inputlabs/repositories?sort=name',
    roadmap: 'https://github.com/orgs/inputlabs/projects/2',
    forum: 'https://github.com/orgs/inputlabs/discussions',
    discord: 'https://discord.gg/s8Yb4pfusT',
    patreon: 'https://www.patreon.com/inputlabs',
  }

  const loadMathJax = [
    'dual_gyro',
    'placeholder'
  ].includes(PAGE)

  const defaultPage = (path) => {
    const paths = {
      '/db':                     '/db/glossary',
      '/devices/alpakka/manual': '/devices/alpakka/manual/mouse',
      '/blog':                   '/blog/live',
    }
    for (let key of Object.keys(paths)) {
      if (path == key) return paths[key]
    }
    throw `Error: default page not found: ${path}`
  }

mixin nav
  - const active = (name) => (name==SECTION) ? 'active' : ''
  div.tab(class=active('devices')):    +a('/devices')           Devices
  div.tab(class=active('contribute')): +a('/contribute')        Contribute
  div.tab(class=active('db')):         +a(defaultPage('/db'))   Accessibility DB
  div.tab(class=active('blog')):       +a(defaultPage('/blog')) Blog

mixin wikilink(href, external=false)
  - const active = (href==PAGE)
  - const cls = (active ? 'active' : '')
  div.link(class=cls)
    if active
      span ->
    if external
      +ax(href)
        block
    else
      +a(href)
        block

mixin a(href)
  a(href=href)
    block

mixin ax(href)
  //- a(href=(ENV=='prod' ? href : 'DISABLED') target='_blank')
  a(href=href target='_blank')
    block

mixin axh(href)
  //- a(href=(ENV=='prod' ? href : 'DISABLED') target='_blank')
  a(href=href target='_blank') #{href}

mixin dl(href)
  a(href=href download)
    block

mixin figure(id, caption, src, cls)
  div.figure(class=cls)
    img(src=src)
    div.caption Figure #{id}: #{caption}
